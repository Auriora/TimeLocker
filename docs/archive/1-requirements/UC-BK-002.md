# UC-BK-002: Validate Backup Integrity

| Field                        | Description                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
|------------------------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| **Use Case ID**              | UC-BK-002                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
| **Name**                     | Validate Backup Integrity                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
| **Primary Actors**           | Power User, System                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
| **Stakeholders & Interests** | **Power User** – wants to ensure backups are valid and can be restored if needed. <br> **System** – must verify data integrity and report any corruption or issues.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
| **Pre-conditions**           | 1. At least one repository with existing snapshots. <br> 2. User has permission to perform integrity checks. <br> 3. No other operations are currently running on the target repository.                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| **Post-conditions**          | * **Successful**: Integrity check completed; report generated; audit log updated with `INTEGRITY_CHECK` event. <br> * **Failure**: Check failed; error logged; user notified of specific issues.                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
| **Main Flow**                | 1. User selects a repository and clicks **Validate Integrity**. <br> 2. System displays options for validation scope (all snapshots, latest N snapshots, specific snapshot). <br> 3. User selects scope and validation level (quick/thorough). <br> 4. System executes `restic check` with appropriate parameters. <br> 5. System displays progress indicator during validation. <br> 6. Upon completion, system generates a detailed report showing: <br>   a. Overall integrity status (pass/fail). <br>   b. Any corrupted files or metadata. <br>   c. Recommendations for repair if issues found. <br> 7. System logs the validation results to the audit log. |
| **Alternative Flows**        | **AF-1: Validation Errors Found** <br>   a. System detects corrupted data or metadata. <br>   b. System highlights affected snapshots and files. <br>   c. System offers repair options if available. <br><br> **AF-2: Validation Cancelled** <br>   a. User cancels the validation process. <br>   b. System stops the check and logs a `INTEGRITY_CHECK_CANCELLED` event. <br>   c. Partial results are displayed if available.                                                                                                                                                                                                                                   |
| **Special Requirements**     | * Must support background execution for large repositories ([NFR-PERF-03](3-4-1-Performance.md#nfrPerf03)). <br> * Must provide detailed error information for any corrupted files ([FR-ERR-002](3-1-7-Error-Handling-Resource-Management.md#frErr002)). <br> * Should minimize repository locking time during validation ([NFR-REL-02](3-4-2-Reliability-Stability.md#nfrRel02)).                                                                                                                                                                                                                                                                                  |
| **Related FRs**              | [FR-BK-002](3-1-2-Backup-Operations.md#frBk002), [FR-BK-005](3-1-2-Backup-Operations.md#frBk005), [FR-ERR-002](3-1-7-Error-Handling-Resource-Management.md#frErr002), [FR-MON-001](3-1-6-Monitoring-Reporting.md#frMon001)                                                                                                                                                                                                                                                                                                                                                                                                                                          |
| **Related NFRs**             | [NFR-PERF-03](3-4-1-Performance.md#nfrPerf03), [NFR-REL-02](3-4-2-Reliability-Stability.md#nfrRel02), NFR-SEC-05                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |