# UC-ERR-001: Handle Backup Error

| Field                        | Description                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
| ---------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| **Use Case ID**              | UC-ERR-001                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
| **Name**                     | Handle Backup Error                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
| **Primary Actors**           | System (background service), Everyday User (notified)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
| **Stakeholders & Interests** | **User** – wants to know when a backup fails and trust the system will attempt recovery. <br> **System** – must detect errors, retry safely, and surface actionable info.                                                                                                                                                                                                                                                                                                                                                                                  |
| **Pre-conditions**           | 1. A backup job is in progress or has just failed. <br> 2. Retry policy parameters (max attempts, back-off) are defined in configuration. <br> 3. Audit log subsystem is operational.                                                                                                                                                                                                                                                                                                                                                         |
| **Post-conditions**          | • Successful recovery: Backup completes on a retry; audit log records `BACKUP_RETRY_SUCCESS`. <br> • Unresolved failure: Backup marked **Failed**; error code and context logged; user notified via UI and OS notification.                                                                                                                                                                                                                                                                                                                             |
| **Main Flow**                | 1. System detects a backup error (non-zero exit from `restic`, I/O error, network timeout). <br> 2. System categorises error (network, repository lock, disk full, permission). <br> 3. System consults retry policy (FR-ERR-001) and schedules next attempt with exponential back-off. <br> 4. System logs `BACKUP_RETRY_SCHEDULED` with attempt count. <br> 5. System retries backup. <br> 6. If retry succeeds, system logs `BACKUP_RETRY_SUCCESS`, updates dashboard status, and notifies user. <br> 7. If max retries reached without success, proceed to Alternative Flow AF-1. |
| **Alternative Flows**        | **AF-1 Retries exhausted** <br> a. System logs `BACKUP_FAILED` with error code and last attempt timestamp. <br> b. System triggers alert: red banner in dashboard, OS notification, optional email/webhook. <br> c. User may click **View Details** to open log and suggested remedies. <br><br> **AF-2 User cancels retry loop** <br> a. User clicks **Cancel Retries** in notification. <br> b. System stops further attempts, logs `BACKUP_RETRY_CANCELLED`.                                                                                                                 |
| **Special Requirements**     | • Retry interval follows exponential back-off with jitter (NFR-REL-02). <br> • Maximum cumulative retry duration ≤ 30 min unless user overrides (NFR-RES-02). <br> • Error messages use plain language and remediation tips (NFR-USE-03, Heuristic 9). <br> • All error events are hash-chained in audit log (FR-MON-006, NFR-AUD-01/02).                                                                                                                                                                                                                           |
| **Related FRs**              | FR-ERR-001, FR-ERR-002, FR-MON-005, FR-MON-006, FR-BK-005                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| **Related NFRs**             | NFR-REL-02/03, NFR-RES-02, NFR-USE-03, NFR-AUD-01/02                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |