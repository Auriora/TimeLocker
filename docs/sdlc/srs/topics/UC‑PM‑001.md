# UC‑PM‑001: Update Retention Policy

| Field                        | Description                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| ---------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| **Use Case ID**              | UC‑PM‑001                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
| **Name**                     | Update Retention Policy                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
| **Primary Actors**           | Power User                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
| **Stakeholders & Interests** | *Power User* – wants to free space and comply with organisational or legal retention rules; *System* – must enforce policy safely without unintended data loss and keep audit trail.                                                                                                                                                                                                                                                                                                                                                                                                                          |
| **Pre‑conditions**           | 1. At least one repository with existing snapshots.2. User has permission to modify retention settings.3. No prune operation currently running.                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
| **Post‑conditions**          | • Successful: New policy saved; `restic forget --prune` executed (immediately or at next maintenance window); audit log `RETENTION_UPDATE` recorded.• Failure: Policy unchanged; error logged; user notified.                                                                                                                                                                                                                                                                                                                                                                                                 |
| **Main Flow**                | 1. User opens **Settings → Retention Policy**.2. System loads current rules (e.g., *keep‑last 7, keep‑daily 30, keep‑monthly 12*).3. User edits values or toggles rule types (last/hourly/daily/weekly/monthly/yearly/tag‑based).4. System displays estimated space savings and number of snapshots affected.5. User clicks **Save & Apply**.6. System validates rules (no negative numbers, at least one rule active).7. System writes new policy to config and schedules/executes `restic forget --prune`.8. Upon completion, system updates dashboard storage chart and writes success entry to audit log. |
| **Alternative Flows**        | **AF‑1 Invalid input**  a. User enters non‑numeric or negative value.  b. System highlights field and shows inline error; flow returns to step 3.**AF‑2 Prune fails (e.g., network issue)**  a. `restic forget --prune` exits non‑zero.  b. System logs `ERROR_PRUNE`, shows notification, and flags policy as **Pending retry**.**AF‑3 User cancels changes**  a. User clicks **Cancel**.  b. Dialog closes; no changes saved.                                                                                                                                                                               |
| **Special Requirements**     | • Validation feedback ≤ 200 ms (NFR‑PERF‑02).• Estimated space‑savings calculation ≤ 2 s for repo ≤ 10 TB (NFR‑PERF‑04).• Must warn if policy would delete all snapshots (NFR‑USE‑03).• Audit log tamper‑evident entry (FR‑MON‑006).                                                                                                                                                                                                                                                                                                                                                                          |
| **Related FRs**              | FR‑PM‑001, FR‑PM‑003, FR‑MON‑001, FR‑MON‑006                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
| **Related NFRs**             | NFR‑PERF‑02/04, NFR‑REL‑03, NFR‑USE‑03, NFR‑AUD‑01/02                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |