# UC‑RM‑001: Register Repository

| Field                        | Description                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
|------------------------------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| **Use Case ID**              | UC‑RM‑001                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| **Name**                     | Register Repository                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
| **Primary Actors**           | Everyday User, Power User                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| **Stakeholders & Interests** | **User**: Wants an easy way to add new storage destinations. <br> **System**: Must verify credentials, ensure region compliance, and store settings securely.                                                                                                                                                                                                                                                                                                                                                                                        |
| **Pre‑conditions**           | 1. Application is installed and running. <br> 2. User has valid credentials or access tokens for the target storage. <br> 3. Network connection is available if it's a remote repository.                                                                                                                                                                                                                                                                                                                                                            |
| **Post‑conditions**          | **Successful**: Repository saved, credentials stored in OS key‑ring, audit log updated. <br> **Failure**: Repository not saved; user informed of error reason.                                                                                                                                                                                                                                                                                                                                                                                       |
| **Main Flow**                | 1. User clicks **Add Repository**. <br> 2. System displays repository‑type picker (Local, External Drive, SFTP, S3, SMB…). <br> 3. User selects type and enters endpoint/path and credentials. <br> 4. System validates connection and, if S3, queries bucket region. <br> 5. If region is outside EEA/UK and user policy `enforce_region=true`, system blocks with GDPR warning; otherwise, continues. <br> 6. System saves repository config and writes `REPO_ADD` event to audit log. <br> 7. Dashboard refreshes with the new repository listed. |
| **Alternative Flows**        | **AF‑1 Invalid credentials**: <br>   a. Validation fails. <br>   b. System shows error message and highlights invalid fields. <br>**AF‑2 Region policy violation (warn‑only)**: <br>   a. Region outside EEA/UK but `enforce_region=false`. <br>   b. System displays warning banner; user may proceed or cancel.                                                                                                                                                                                                                                    |
| **Special Requirements**     | - Credential storage via OS key‑ring (FR‑SEC‑002). <br> - Region validation ≤ 50 ms overhead (NFR‑SEC‑12). <br> - Form validation feedback ≤ 200 ms (NFR‑PERF‑02).                                                                                                                                                                                                                                                                                                                                                                                   |
| **Related FRs**              | FR‑RM‑001 … 005, FR‑SEC‑002, FR‑MON‑001                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
| **Related NFRs**             | NFR‑SEC‑12, NFR‑USE‑01/02, NFR‑PERF‑02                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
